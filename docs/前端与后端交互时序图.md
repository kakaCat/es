# 前端与后端交互时序图

## 1. 创建集群流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端页面
    participant B as 后端API
    participant K as Kubernetes
    participant E as Elasticsearch
    participant D as 数据库

    U->>F: 填写创建集群表单
    F->>F: 验证必填字段(租户组织ID等)
    F->>B: POST /clusters (JSON数据)
    B->>B: 验证租户配额
    B->>D: 保存租户容器元数据
    B->>D: 保存部署状态
    B->>K: 执行cluster.sh create脚本
    K->>E: 部署Elasticsearch集群
    K-->>B: 返回部署结果
    B->>D: 更新部署状态为"created"
    B->>D: 更新租户容器状态为"created"
    B-->>F: 返回部署结果
    F->>F: 显示成功消息
    F-->>U: 展示创建成功结果
```

## 2. 删除集群流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端页面
    participant B as 后端API
    participant K as Kubernetes
    participant E as Elasticsearch

    U->>F: 填写删除集群表单
    F->>B: DELETE /clusters (命名空间)
    B->>K: 执行cluster.sh delete脚本
    K->>E: 删除Elasticsearch集群
    K-->>B: 返回删除结果
    B-->>F: 返回删除结果
    F->>F: 显示成功消息
    F-->>U: 展示删除成功结果
```

## 3. 查询所有集群流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端页面
    participant B as 后端API
    participant D as 数据库

    U->>F: 点击查询所有集群按钮
    F->>B: GET /clusters
    B->>D: 查询所有部署状态
    D-->>B: 返回集群列表
    B-->>F: 返回JSON格式集群列表
    F->>F: 格式化显示集群列表
    F-->>U: 展示集群列表
```

## 4. 查询集群详情流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端页面
    participant B as 后端API
    participant D as 数据库
    participant K as Kubernetes

    U->>F: 输入命名空间查询详情
    F->>B: GET /clusters/{namespace}
    B->>D: 查询部署状态
    D-->>B: 返回部署状态
    B->>K: 查询Kubernetes状态
    K-->>B: 返回Kubernetes状态
    B->>B: 合并状态信息
    B-->>F: 返回集群详情
    F->>F: 格式化显示详情
    F-->>U: 展示集群详情
```

## 5. API接口说明

### 5.1 创建集群
- **URL**: `POST /clusters`
- **参数**: 
  - tenant_org_id (必填): 租户组织ID
  - user (必填): 用户
  - service_name (必填): 服务名称
  - namespace (可选): 命名空间
  - replicas: 副本数
  - cpu_request: CPU请求
  - cpu_limit: CPU限制
  - mem_request: 内存请求
  - mem_limit: 内存限制
  - disk_size: 磁盘大小
  - gpu_count: GPU数量
  - dimension: 向量维度
  - vector_count: 向量数量
  - index_limit: 索引限制
  - gitlab_url: GitLab URL
- **响应**: 部署结果

### 5.2 删除集群
- **URL**: `DELETE /clusters`
- **参数**: 
  - namespace (必填): 命名空间
- **响应**: 删除结果

### 5.3 查询所有集群
- **URL**: `GET /clusters`
- **参数**: 无
- **响应**: 集群列表JSON

### 5.4 查询集群详情
- **URL**: `GET /clusters/{namespace}`
- **参数**: namespace (路径参数)
- **响应**: 集群详情JSON