# Prometheus configuration
prometheus:
  enabled: true
  replicaCount: 1
  image:
    repository: prom/prometheus
    tag: v2.47.0
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 9090

  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi

  persistence:
    enabled: true
    storageClass: "hostpath"
    size: 10Gi

  retention:
    days: 15

  scrapeInterval: 30s
  evaluationInterval: 30s

  # Scrape configurations
  scrapeConfigs:
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
        - role: pod
      relabel_configs:
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
          action: keep
          regex: true
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
          action: replace
          target_label: __metrics_path__
          regex: (.+)
        - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
          action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          target_label: __address__

    - job_name: 'elasticsearch'
      static_configs:
        - targets: ['elasticsearch:9200']

# Grafana configuration
grafana:
  enabled: true
  replicaCount: 1
  image:
    repository: grafana/grafana
    tag: 10.1.0
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 3000

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  persistence:
    enabled: true
    storageClass: "hostpath"
    size: 5Gi

  adminUser: admin
  adminPassword: admin

  datasources:
    - name: Prometheus
      type: prometheus
      url: http://prometheus:9090
      isDefault: true
      access: proxy

  dashboards:
    enabled: true
    # Dashboard configurations will be loaded via ConfigMaps

# Service account
serviceAccount:
  create: true
  name: es-monitoring

# RBAC for Prometheus service discovery
rbac:
  create: true
