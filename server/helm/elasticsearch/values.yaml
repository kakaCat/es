# Default values for elasticsearch
replicaCount: 3

image:
  repository: docker.elastic.co/elasticsearch/elasticsearch
  tag: "8.11.0"
  pullPolicy: IfNotPresent

# IVF Plugin configuration
ivfPlugin:
  enabled: true
  image:
    repository: es-ivf-plugin
    tag: latest
  # Plugin will be installed via init container

clusterName: elasticsearch

resources:
  requests:
    cpu: 1000m
    memory: 2Gi
  limits:
    cpu: 2000m
    memory: 4Gi

persistence:
  enabled: true
  storageClass: "hostpath"
  size: 10Gi
  accessModes:
    - ReadWriteOnce

# Elasticsearch configuration
esConfig:
  elasticsearch.yml: |
    cluster.name: ${CLUSTER_NAME}
    network.host: 0.0.0.0
    discovery.seed_hosts: elasticsearch-headless
    cluster.initial_master_nodes: elasticsearch-0,elasticsearch-1,elasticsearch-2
    xpack.security.enabled: false
    xpack.monitoring.collection.enabled: true

    # Vector search plugin settings
    ivf.enabled: true
    ivf.nlist: 100
    ivf.nprobe: 10

service:
  type: ClusterIP
  port: 9200
  transportPort: 9300

headlessService:
  enabled: true

# Service account
serviceAccount:
  create: true
  name: elasticsearch

# Security context
securityContext:
  runAsUser: 1000
  fsGroup: 1000

# Environment variables
env:
  - name: CLUSTER_NAME
    value: "elasticsearch"
  - name: ES_JAVA_OPTS
    value: "-Xms1g -Xmx1g"

# Init containers for plugin installation
initContainers:
  - name: install-ivf-plugin
    image: busybox:1.36
    command:
      - sh
      - -c
      - |
        echo "Installing IVF plugin..."
        # Plugin will be mounted from ConfigMap or downloaded
        # bin/elasticsearch-plugin install file:///plugins/es-ivf-plugin.zip
    volumeMounts:
      - name: plugins
        mountPath: /usr/share/elasticsearch/plugins

# Additional volumes
volumes:
  - name: plugins
    emptyDir: {}

# Liveness and readiness probes
livenessProbe:
  httpGet:
    path: /_cluster/health?local=true
    port: 9200
  initialDelaySeconds: 90
  periodSeconds: 10
  timeoutSeconds: 5

readinessProbe:
  httpGet:
    path: /_cluster/health?local=true
    port: 9200
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5

# Node affinity and tolerations
affinity: {}
tolerations: []
nodeSelector: {}

# Prometheus monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
